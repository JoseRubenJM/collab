{"ast":null,"code":"import _asyncToGenerator from \"/Users/jose/Desktop/proyects/fluid-angular/FluidAngular/collaborative-textarea/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\nimport * as querystring from \"querystring\";\nimport { default as Axios } from \"axios\";\nimport * as uuid from \"uuid\";\nimport { debug } from \"./debug\";\nexport class RestWrapper {\n  constructor(baseurl,\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  defaultHeaders,\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  defaultQueryString, cacheBust = false, maxContentLength = 1000 * 1024 * 1024, axios = Axios) {\n    this.baseurl = baseurl;\n    this.defaultHeaders = defaultHeaders;\n    this.defaultQueryString = defaultQueryString;\n    this.cacheBust = cacheBust;\n    this.maxContentLength = maxContentLength;\n    this.axios = axios;\n  }\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  get(url, queryString, headers) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const options = {\n        baseURL: _this.baseurl,\n        headers,\n        maxContentLength: _this.maxContentLength,\n        method: \"GET\",\n        url: `${url}${_this.generateQueryString(queryString)}`\n      };\n      return _this.request(options, 200);\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  post(url, requestBody, queryString, headers) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const options = {\n        baseURL: _this2.baseurl,\n        data: requestBody,\n        headers,\n        maxContentLength: _this2.maxContentLength,\n        method: \"POST\",\n        url: `${url}${_this2.generateQueryString(queryString)}`\n      };\n      return _this2.request(options, 201);\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  delete(url, queryString, headers) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const options = {\n        baseURL: _this3.baseurl,\n        headers,\n        maxContentLength: _this3.maxContentLength,\n        method: \"DELETE\",\n        url: `${url}${_this3.generateQueryString(queryString)}`\n      };\n      return _this3.request(options, 204);\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  patch(url, requestBody, queryString, headers) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      const options = {\n        baseURL: _this4.baseurl,\n        data: requestBody,\n        headers,\n        maxContentLength: _this4.maxContentLength,\n        method: \"PATCH\",\n        url: `${url}${_this4.generateQueryString(queryString)}`\n      };\n      return _this4.request(options, 200);\n    })();\n  }\n  request(options, statusCode) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      var _a;\n      if (_this5.defaultHeaders) {\n        options.headers = Object.assign(Object.assign({}, _this5.defaultHeaders), options.headers);\n      }\n      if (!((_a = options.headers) === null || _a === void 0 ? void 0 : _a[\"x-correlation-id\"])) {\n        options.headers = Object.assign({\n          \"x-correlation-id\": uuid.v4()\n        }, options.headers);\n      }\n      return new Promise((resolve, reject) => {\n        _this5.axios.request(options).then(response => {\n          resolve(response.data);\n        }).catch(error => {\n          var _a, _b, _c;\n          if (error && error.config) {\n            // eslint-disable-next-line max-len\n            debug(`[${error.config.method}] request to [${error.config.url}] failed with [${error.code}] [${error.message}]`);\n          } else {\n            debug(`request to ${options.url} failed ${error ? error.message : \"\"}`);\n          }\n          if (((_a = error === null || error === void 0 ? void 0 : error.response) === null || _a === void 0 ? void 0 : _a.status) === 429 && ((_c = (_b = error === null || error === void 0 ? void 0 : error.response) === null || _b === void 0 ? void 0 : _b.data) === null || _c === void 0 ? void 0 : _c.retryAfter) > 0) {\n            setTimeout(() => {\n              _this5.request(options, statusCode).then(resolve).catch(reject);\n            }, error.response.data.retryAfter * 1000);\n          } else if (error.response && error.response.status !== statusCode) {\n            reject(error.response.status);\n          } else {\n            reject(error);\n          }\n        });\n      });\n    })();\n  }\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  generateQueryString(queryStringValues) {\n    if (this.defaultQueryString || queryStringValues) {\n      const queryStringMap = this.cacheBust ? Object.assign(Object.assign(Object.assign({}, this.defaultQueryString), queryStringValues), {\n        cacheBust: Date.now()\n      }) : Object.assign(Object.assign({}, this.defaultQueryString), queryStringValues);\n      const queryString = querystring.stringify(queryStringMap);\n      if (queryString !== \"\") {\n        return `?${queryString}`;\n      }\n    }\n    return \"\";\n  }\n}\n//# sourceMappingURL=restWrapper.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}