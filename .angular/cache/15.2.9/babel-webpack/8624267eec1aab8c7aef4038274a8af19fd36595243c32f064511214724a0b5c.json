{"ast":null,"code":"/*!\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n/**\n * Stores a unique and sorted set of segments, or objects with segments\n *\n * This differs from a normal sorted set in that the keys are not fixed.\n * The segments are sorted via their ordinals which can change as the merge tree is modified.\n * Eventhough the values of the ordinals can change their ordering and uniqueness cannot, so the order of a set of\n * segments ordered by their ordinals will always have the same order even if the ordinal values on\n * the segments changes. This invarient allows ensure the segments stay ordered and unique, and that new segments\n * can be inserted into that order.\n */\nexport class SortedSegmentSet {\n  constructor() {\n    this.oridinalSortedItems = [];\n  }\n  get size() {\n    return this.oridinalSortedItems.length;\n  }\n  get items() {\n    return this.oridinalSortedItems;\n  }\n  addOrUpdate(newItem, update) {\n    const postition = this.findOrdinalPosition(this.getOrdinal(newItem));\n    if (postition.exists) {\n      if (update) {\n        update(this.oridinalSortedItems[postition.index], newItem);\n      }\n    } else {\n      this.oridinalSortedItems.splice(postition.index, 0, newItem);\n    }\n  }\n  remove(item) {\n    const position = this.findOrdinalPosition(this.getOrdinal(item));\n    if (position.exists) {\n      this.oridinalSortedItems.splice(position.index, 1);\n      return true;\n    }\n    return false;\n  }\n  has(item) {\n    const position = this.findOrdinalPosition(this.getOrdinal(item));\n    return position.exists;\n  }\n  getOrdinal(item) {\n    const maybeObject = item;\n    if (maybeObject && maybeObject.segment) {\n      return maybeObject.segment.ordinal;\n    }\n    const maybeSegment = item;\n    return maybeSegment.ordinal;\n  }\n  findOrdinalPosition(ordinal, start, end) {\n    if (this.oridinalSortedItems.length === 0) {\n      return {\n        exists: false,\n        index: 0\n      };\n    }\n    if (start === undefined || end === undefined) {\n      return this.findOrdinalPosition(ordinal, 0, this.oridinalSortedItems.length - 1);\n    }\n    const index = start + Math.floor((end - start) / 2);\n    if (this.getOrdinal(this.oridinalSortedItems[index]) > ordinal) {\n      if (start === index) {\n        return {\n          exists: false,\n          index\n        };\n      }\n      return this.findOrdinalPosition(ordinal, start, index - 1);\n    } else if (this.getOrdinal(this.oridinalSortedItems[index]) < ordinal) {\n      if (index === end) {\n        return {\n          exists: false,\n          index: index + 1\n        };\n      }\n      return this.findOrdinalPosition(ordinal, index + 1, end);\n    }\n    return {\n      exists: true,\n      index\n    };\n  }\n}\n//# sourceMappingURL=sortedSegmentSet.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}